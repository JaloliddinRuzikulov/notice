<!-- Navigation Drawer -->
<nav class="md-navigation-drawer">
    <div class="md-navigation-drawer-content">
        <!-- Header -->
        <div class="md-navigation-drawer-header">
            <div style="padding: var(--md-sys-spacing-6);">
                <h2 class="md-typescale-title-medium" style="color: var(--md-sys-color-on-surface); margin: 0 0 var(--md-sys-spacing-2) 0;">
                    Xabarnoma Tizimi
                </h2>
                <p class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant); margin: 0;">
                    Qashqadaryo IIB
                </p>
            </div>
        </div>
        
        <!-- Navigation Items -->
        <div class="md-navigation-drawer-body">
            <ul class="md-navigation-list">
                <li class="md-navigation-list-item">
                    <a href="/" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">dashboard</span>
                        <span>Bosh sahifa</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-item">
                    <a href="/sip-phone" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">phone</span>
                        <span>SIP Telefon</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-item">
                    <a href="/broadcast" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">campaign</span>
                        <span>Xabar yuborish</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-item">
                    <a href="/employees" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">group</span>
                        <span>Xodimlar</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-item">
                    <a href="/call-history" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">history</span>
                        <span>Qo'ng'iroqlar tarixi</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-divider"></li>
                
                <li class="md-navigation-list-item">
                    <a href="/audio-files" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">library_music</span>
                        <span>Audio fayllar</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-item">
                    <a href="/reports" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">analytics</span>
                        <span>Hisobotlar</span>
                    </a>
                </li>
                
                <li class="md-navigation-list-divider"></li>
                
                <li class="md-navigation-list-item">
                    <a href="/users" class="md-navigation-list-item-link">
                        <span class="material-symbols-outlined">manage_accounts</span>
                        <span>Foydalanuvchilar</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Footer -->
        <div class="md-navigation-drawer-footer">
            <div style="padding: var(--md-sys-spacing-6);">
                <div style="display: flex; align-items: center; margin-bottom: var(--md-sys-spacing-4);">
                    <div style="width: var(--md-sys-spacing-10); height: var(--md-sys-spacing-10); background: var(--md-sys-color-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: var(--md-sys-spacing-3);">
                        <span class="material-symbols-outlined" style="font-size: var(--md-sys-spacing-6); color: var(--md-sys-color-on-primary);">
                            person
                        </span>
                    </div>
                    <div>
                        <p class="md-typescale-body-medium" style="color: var(--md-sys-color-on-surface); margin: 0;">
                            Foydalanuvchi
                        </p>
                        <p class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant); margin: 0;">
                            Administrator
                        </p>
                    </div>
                </div>
                
                <button onclick="logout()" class="md-button md-button-outlined" style="width: 100%;">
                    <span class="material-symbols-outlined">logout</span>
                    <span>Chiqish</span>
                </button>
            </div>
        </div>
    </div>
</nav>

<!-- Top App Bar -->
<header class="md-top-app-bar">
    <div class="md-top-app-bar-content">
        <button class="md-icon-button" onclick="toggleNavigationDrawer()">
            <span class="material-symbols-outlined">menu</span>
        </button>
        
        <div class="md-top-app-bar-title">
            <span id="pageTitle">Xabarnoma Tizimi</span>
        </div>
        
        <div class="md-top-app-bar-actions">
            <!-- Real-time status indicators -->
            <div style="display: flex; align-items: center; margin-right: var(--md-sys-spacing-4);">
                <div id="connectionStatus" class="status-indicator" style="width: 8px; height: 8px; border-radius: 50%; background: var(--md-sys-color-error); margin-right: var(--md-sys-spacing-2);"></div>
                <span class="md-typescale-body-small" style="color: var(--md-sys-color-on-surface-variant);">
                    WebSocket
                </span>
            </div>
            
            <button class="md-icon-button" onclick="toggleNotifications()" title="Bildirishnomalar">
                <span class="material-symbols-outlined">notifications</span>
                <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
            </button>
            
            <button class="md-icon-button" onclick="showSettings()" title="Sozlamalar">
                <span class="material-symbols-outlined">settings</span>
            </button>
        </div>
    </div>
</header>

<!-- Navigation Drawer Overlay -->
<div id="navigationDrawerOverlay" class="md-navigation-drawer-overlay" onclick="closeNavigationDrawer()"></div>

<script>
    // Navigation functionality
    function toggleNavigationDrawer() {
        const drawer = document.querySelector('.md-navigation-drawer');
        const overlay = document.getElementById('navigationDrawerOverlay');
        
        if (drawer.classList.contains('open')) {
            closeNavigationDrawer();
        } else {
            drawer.classList.add('open');
            overlay.classList.add('active');
        }
    }
    
    function closeNavigationDrawer() {
        const drawer = document.querySelector('.md-navigation-drawer');
        const overlay = document.getElementById('navigationDrawerOverlay');
        
        drawer.classList.remove('open');
        overlay.classList.remove('active');
    }
    
    function logout() {
        if (confirm('Tizimdan chiqishni xohlaysizmi?')) {
            fetch('/api/user/logout', { method: 'POST' })
                .then(() => {
                    window.location.href = '/login';
                })
                .catch(console.error);
        }
    }
    
    function toggleNotifications() {
        // Implementation for notifications panel
        console.log('Notifications toggled');
    }
    
    function showSettings() {
        // Implementation for settings
        console.log('Settings opened');
    }
    
    // Update active navigation item based on current page
    function updateActiveNavigation() {
        const currentPath = window.location.pathname;
        const navItems = document.querySelectorAll('.md-navigation-list-item-link');
        
        navItems.forEach(item => {
            const href = item.getAttribute('href');
            if (href === currentPath || (currentPath === '/' && href === '/')) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    }
    
    // WebSocket connection status indicator
    function updateConnectionStatus(connected) {
        const indicator = document.getElementById('connectionStatus');
        if (connected) {
            indicator.style.background = 'var(--md-sys-color-primary)';
            indicator.title = 'Ulangan';
        } else {
            indicator.style.background = 'var(--md-sys-color-error)';
            indicator.title = 'Ulanmagan';
        }
    }
    
    // Initialize navigation
    document.addEventListener('DOMContentLoaded', function() {
        updateActiveNavigation();
        
        // Listen for WebSocket connection status
        if (typeof socket !== 'undefined') {
            socket.on('connect', () => updateConnectionStatus(true));
            socket.on('disconnect', () => updateConnectionStatus(false));
        }
    });
    
    // Close navigation drawer on mobile when clicking outside
    document.addEventListener('click', function(event) {
        const drawer = document.querySelector('.md-navigation-drawer');
        const menuButton = document.querySelector('.md-top-app-bar button');
        
        if (!drawer.contains(event.target) && !menuButton.contains(event.target)) {
            closeNavigationDrawer();
        }
    });
    
    // Handle escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeNavigationDrawer();
        }
    });
</script>